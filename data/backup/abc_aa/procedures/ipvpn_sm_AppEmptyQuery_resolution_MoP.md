# Method of Procedure (MoP) - AppEmptyQueryException Alerts Resolution

## Description
This MoP document outlines the resolution steps for addressing AppEmptyQueryException alerts related to missing data from bigcust tables. The alerts pertain to two categories: IF (Interface Metrics) and CPU/MEM (CPU and Memory Metrics).

## Affected Alerts
1. IF Alerts:
   - Occurred for 5-minute intervals starting from `2023-10-12 14:30:00` until `2023-10-12 14:50:00`.
2. CPU/MEM Alerts:
   - Occurred for 5-minute intervals starting from `2023-10-12 14:30:00` until `2023-10-12 14:45:00` and then for `2023-10-12 14:55:00` & `2023-10-12 15:00:00`.

## Resolution Steps

### Resolution for IF Alerts:
1. Check `bigcust.perf_interfacemetrics_ipvpn_hist` table to confirm the missing data for the mentioned 5-minute intervals.
2. Review the CSV file loading process into HDFS for errors:
   - Connect to `ipvpn@un2` and navigate to the log file:
     ```
     ssh root@un2
     su ipvpn
     tail -f /shared/abc/ip_vpn/interfaces_flow/Dataparser/scripts/log/nnm_interface_metrics.cron.20231012.log
     ```
   - The last loaded CSV file was `InterfaceMetrics_20231012142500238.csv.gz` at `2023-10-12 14:28:00`. No files were loaded from that point until 14:50, with the message: "File '/home/custompoller/nnm_interface_metrics/InterfaceMetrics*.csv.gz' not found."
3. Verify the transfer process on `nnmprd01` for errors:
   - Connect to `nnmprd01` via passwordless SSH from `un2`:
     ```
     ssh custompoller@nnmprd01
     ```
   - Review the transfer log:
     ```
     tail -f /home/custompoller/export_metrics/log/transfer-new-files-cut.20231012.log
     ```
     The last file moved from the source directory to the destination directory on `nnmprd01` was `InterfaceMetrics_20231012142500238.csv.gz` at `14:28:01`. This continues until `14:50`, aligning with the observations in the `bigcust.perf_interfacemetrics_ipvpn_hist` table.

#### Conclusion for IF Alerts
No files were generated by NNM during the intervals when we received the IF alerts.

### Resolution for CPU/MEM Alerts:
1. Check `bigcust.nnm_ipvpn_componentmetrics_hist` table to confirm the missing data for the mentioned 5-minute intervals.
2. Examine the SFTP transfer process from `nnprd01` for errors:
   - Navigate to the log file on `ipvpn@un2`:
     ```
     tail -f /shared/abc/ip_vpn/log/nnm_component_metrics.cron.20231012.log
     ```
     The last SFTP transfer was for the file `BIG-CUSTOMERS-CPU-MEM-UTIL_20231012142323337.csv.gz` at `14:26`. Subsequently, the logs show the message "No file found.. sleep and try again.." until `14:58`, when a CSV file was found.

#### Conclusion for CPU/MEM Alerts
No files were generated by NNM during the intervals when we received the CPU/MEM alerts.
